<div class="desktop-only">
    <p-table 
        [value]="events()"          
        [paginator]="true"
        [rows]="5"
        [tableStyle]="{ 'min-width': '50rem' }"
        >
        <ng-template #header>
            <tr>
                <th pSortableColumn="title">
                    Title
                    <p-sortIcon field="title"></p-sortIcon>
                </th>
                <th pSortableColumn="eventDateTime">
                    Date
                    <p-sortIcon field="Date"></p-sortIcon>
                </th>
                <th pSortableColumn="location.alias">
                    Location alias
                    <p-sortIcon field="Location"></p-sortIcon>
                </th>
                <th pSortableColumn="confirmed">
                    Confirmed
                    <p-sortIcon field="Yes"></p-sortIcon>
                </th>
                <th pSortableColumn="no">
                    Not coming
                <p-sortIcon field="No"></p-sortIcon>
                </th>
                <th pSortableColumn="maybe">
                    Maybe
                <p-sortIcon field="Maybe"></p-sortIcon>
                </th>
                <th pSortableColumn="pending">
                    Pending answer
                    <p-sortIcon field="Pending"></p-sortIcon>
                </th>
                <th>
                    Stats
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-event>
            <tr>
                <td>{{ event.title }}</td>
                <td>{{ event.eventDateTime | date:'short' }}</td>
                <td>{{ event.location?.alias }}</td>
                <td>{{ event.confirmed }}</td>
                <td>{{ event.notComing }}</td>  
                <td>{{ event.undecided }}</td>
                <td>{{ event.pending}}</td>
                <td><button class="more-info-btn" (click)="toggleEventDetails(event.id)">
                    See who</button>
                </td>
                    
            </tr>

            @if (expandedEventId() === event.id) {
                <tr class="expansion-row">
                    <td [attr.colspan]="7">
                        <div class="attendees-details">
                            <div class="status-group">
                                <strong>✅ Confirmed</strong>
                                @if (attendeesByEvent().get(event.id)?.confirmed?.length) {
                                    <ul>
                                    @for (email of attendeesByEvent().get(event.id)?.confirmed; track email) {
                                        <li class="email-item">
                                        <span>{{ email }}</span>
                                        <button class="email-btn" 
                                                title="Send reminder">
                                            <span class="material-icons">mail</span>
                                        </button>
                                    }
                                    </ul>
                                } @else {
                                    <p class="empty-state">No confirmed guests</p>
                                }
                            </div>

                            <div class="status-group">
                                <strong>❌ Not Coming</strong>
                                @if (attendeesByEvent().get(event.id)?.notComing?.length) {
                                    <ul>
                                    @for (email of attendeesByEvent().get(event.id)?.notComing; track email) {
                                        <li class="email-item">
                                        <span>{{ email }}</span>
                                        <button class="email-btn" 
                                                title="Send reminder">
                                            <span class="material-icons">mail</span>
                                        </button>
                                    }
                                    </ul>
                                } @else {
                                    <p class="empty-state">No one rejected</p>
                                }
                            </div>

                            <div class="status-group">
                                <strong>⏳ Pending</strong>
                                @if (attendeesByEvent().get(event.id)?.pending?.length) {
                                    <ul>
                                    @for (email of attendeesByEvent().get(event.id)?.pending; track email) {
                                        <li class="email-item">
                                        <span>{{ email }}</span>
                                        <button class="email-btn" 
                                                title="Send reminder">
                                            <span class="material-icons">mail</span>
                                        </button>
                                    </li>
                                    }
                                    </ul>
                                } @else {
                                    <p class="empty-state">No pending responses</p>
                                }
                            </div>
                        </div>
                    </td>
                </tr>
            }
        </ng-template>
    </p-table>
</div>

<div class="mobile-only">
    @for(event of events(); track event.id) {
        <app-table-card   
            [event]="event" 
            (moreInfo)="toggleEventDetails($event)">
        </app-table-card>
    }
</div>
