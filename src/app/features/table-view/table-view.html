<p-table 
    [value]="events()"          
    [paginator]="true"
    [rows]="5
    "
    [tableStyle]="{ 'min-width': '50rem' }"
    >
    <ng-template #header>
        <tr>
            <th pSortableColumn="title">
                Title
                <p-sortIcon field="title"></p-sortIcon>
            </th>
            <th pSortableColumn="eventDateTime">
                Date
                <p-sortIcon field="Date"></p-sortIcon>
            </th>
            <th pSortableColumn="location.alias">
                Location alias
                <p-sortIcon field="Location"></p-sortIcon>
            </th>
            <th pSortableColumn="confirmed">
                Confirmed
                <p-sortIcon field="Yes"></p-sortIcon>
            </th>
            <th pSortableColumn="no">
                Not coming
            <p-sortIcon field="No"></p-sortIcon>
            </th>
            <th pSortableColumn="maybe">
                Maybe
            <p-sortIcon field="Maybe"></p-sortIcon>
            </th>
            <th pSortableColumn="pending">
                Pending answer
                <p-sortIcon field="Pending"></p-sortIcon>
            </th>
        </tr>
    </ng-template>
    <ng-template #body let-event>
        <tr>
            <td>{{ event.title }}</td>
            <td>{{ event.eventDateTime | date:'short' }}</td>
            <td>{{ event.location?.alias }}</td>
            <td>
                <button (click)="toggleEventDetails(event.id)">
                {{ event.confirmed }}
                <span class="toggle-icon">▼</span>
                </button> 
            </td>
            <td>  
                <button (click)="toggleEventDetails(event.id)">
                {{ event.notComing }}
                <span class="toggle-icon">▼</span>
                </button>
            </td>  
            
            <td>
                <button (click)="toggleEventDetails(event.id)">
                {{ event.undecided }}
                <span class="toggle-icon">▼</span>
                </button>
            </td>
            <td>
                <button (click)="toggleEventDetails(event.id)">
                {{ event.pending}}
                <span class="toggle-icon">▼</span>
                </button>
            </td>
        </tr>

        @if (expandedEventId() === event.id) {
            <tr class="expansion-row">
                <td [attr.colspan]="7">
                    <div class="attendees-details">
                        <!-- Confirmed -->
                        <div class="status-group">
                            <strong>✅ Confirmed</strong>
                            @if (attendeesByEvent().get(event.id)?.confirmed?.length) {
                                <ul>
                                @for (email of attendeesByEvent().get(event.id)?.confirmed; track email) {
                                    <li>{{ email }}</li>
                                }
                                </ul>
                            } @else {
                                <p class="empty-state">No confirmed attendees</p>
                            }
                        </div>

                        <div class="status-group">
                            <strong>❌ Not Coming</strong>
                            @if (attendeesByEvent().get(event.id)?.notComing?.length) {
                                <ul>
                                @for (email of attendeesByEvent().get(event.id)?.notComing; track email) {
                                    <li>{{ email }}</li>
                                }
                                </ul>
                            } @else {
                                <p class="empty-state">No one rejected</p>
                            }
                        </div>

                        <div class="status-group">
                            <strong>⏳ Pending</strong>
                            @if (attendeesByEvent().get(event.id)?.pending?.length) {
                                <ul>
                                @for (email of attendeesByEvent().get(event.id)?.pending; track email) {
                                    <li>{{ email }}</li>
                                }
                                </ul>
                            } @else {
                                <p class="empty-state">No pending responses</p>
                            }
                        </div>
                    </div>
                </td>
            </tr>
        }
    </ng-template>
</p-table>
